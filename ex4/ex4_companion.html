<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2020b"><title>MATLAB Companion Script for Machine Learning ex4 (Optional)</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S2 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S3 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S4 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S5 { margin-bottom: 20px; padding-bottom: 4px;  }
.S6 { margin: 0px; padding: 10px 0px 10px 5px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 700; text-align: start;  }
.S7 { margin: -1px 0px 0px; padding: 10px 0px 10px 7px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: start;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S11 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S12 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S13 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S14 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0' id = 'T_13370202' ><span>MATLAB Companion Script for </span><span style=' font-style: italic;'>Machine Learning</span><span> ex4 (Optional)</span></h1><h2  class = 'S1' id = 'H_5E50F655' ><span>Introduction</span></h2><div  class = 'S2'><span>Coursera's</span><span style=' font-style: italic;'> Machine Learning</span><span> was designed to provide you with a greater understanding of machine learning algorithms- what they are, how they work, and where to apply them. You are also shown techniques to improve their performance and to address common issues. As is mentioned in the course, there are many tools available that allow you to use machine learning algorithms </span><span style=' font-style: italic;'>without</span><span> having to implement them yourself. This Live Script was created by MathWorks to help </span><span style=' font-style: italic;'>Machine Learning</span><span> students explore the data analysis and machine learning tools available in MATLAB.</span></div><h2  class = 'S1' id = 'H_8D135D31' ><span>FAQ</span></h2><div  class = 'S2'><span style=' font-weight: bold;'>Who is this intended for?</span></div><ul  class = 'S3'><li  class = 'S4'><span>This script is intended for students using MATLAB Online who have completed ex4 and want to learn more about the corresponding machine learning tools in MATLAB.</span></li></ul><div  class = 'S2'><span style=' font-weight: bold;'>How do I use this script?</span></div><ul  class = 'S3'><li  class = 'S4'><span>In the sections that follow, read the information provided about the data analysis and machine learning tools in MATLAB, then run the code in each section and examine the results. You may also be presented with instructions for using a MATLAB machine learning app. This script should be located in the ex4 folder which should be set as your Current Folder in MATLAB Online.</span></li></ul><div  class = 'S2'><span style=' font-weight: bold;'>Can I use the tools in this companion script to complete the programming exercises?</span></div><ul  class = 'S3'><li  class = 'S4'><span>No. Most algorithm steps implemented in the programming exercises are handled automatically by MATLAB machine learning functions. Additionally, the results will be similar, but not identical, to those in the programming exercises due to differences in implementation, parameter settings, and randomization.</span></li></ul><div  class = 'S2'><span style=' font-weight: bold;'>Where can I obtain help with this script or report issues?</span></div><ul  class = 'S3'><li  class = 'S4'><span>As this script is not part of the original course materials, please direct any questions, comments, or issues to the </span><span style=' font-style: italic;'>MATLAB Help</span><span> discussion forum.</span></li></ul><h1  class = 'S0' id = 'T_305584EA' ><span>Create and Train a Neural Network in MATLAB</span></h1><div  class = 'S2'><span>In this Live Script, we will use the </span><span style=' font-style: italic;'>Neural Net Pattern Recognition App</span><span> from the </span><a href = "https://www.mathworks.com/products/neural-network.html"><span>Neural Network Toolbox</span></a><span> to build and train a neural network for hand-written digit recognition.</span></div><h2  class = 'S1' id = 'H_4210DE50' ><span>Files needed for this script</span></h2><ul  class = 'S3'><li  class = 'S4'><span style=' font-family: monospace;'>ex4data1.mat</span><span> - Training set of hand-written digits</span></li></ul><div  class = 'S5'><div  class = 'S6'><span style=' font-weight: bold;'>Table of Contents</span></div><div  class = 'S7'><a href = "#T_13370202"><span>MATLAB Companion Script for Machine Learning ex4 (Optional)
</span></a><span>    </span><a href = "#H_5E50F655"><span>Introduction
</span></a><span>    </span><a href = "#H_8D135D31"><span>FAQ
</span></a><a href = "#T_305584EA"><span>Create and Train a Neural Network in MATLAB
</span></a><span>    </span><a href = "#H_4210DE50"><span>Files needed for this script
</span></a><a href = "#T_D56FA7DE"><span>Create a Pattern Recognition Network using nprtool
</span></a><span>    </span><a href = "#H_8AE17DE5"><span>Load the data
</span></a><span>    </span><a href = "#H_EFAC5F00"><span>Choose an appropriate neural network app
</span></a><span>    </span><a href = "#H_3C25A619"><span>Create and train a neural network for pattern recognition 
</span></a><span>        </span><a href = "#H_DCD784CC"><span>Open the Pattern Recognition App and select the data
</span></a><span>        </span><a href = "#H_5515265E"><span>Create and train the network
</span></a><span>        </span><a href = "#H_94AFB2C8"><span>Evaluate and export the network
</span></a><span>    </span><a href = "#H_3CD5A081"><span>Predict digits using the trained network variable
</span></a><a href = "#T_E3BFF74C"><span>Build and Train a Customized Neural Network Programatically
</span></a><span>    </span><a href = "#H_5E627C75"><span>Train a custom network with regularization
</span></a><a href = "#T_83081B30"><span>Local Functions
</span></a><span>    </span><a href = "#H_D044A2ED"><span>imageNet</span></a></div></div><h1  class = 'S0' id = 'T_D56FA7DE' ><span>Create a Pattern Recognition Network using </span><span style=' font-family: monospace;'>nprtool</span></h1><h2  class = 'S1' id = 'H_8AE17DE5' ><span>Load the data</span></h2><div  class = 'S2'><span>Run the code in this section to load the image data matrix </span><span style=' font-family: monospace;'>X</span><span> and the digit label vector </span><span style=' font-family: monospace;'>y</span><span>. Note that before creating and training a multi-class neural network classifier in MATLAB, the label vector </span><span style=' font-family: monospace;'>y</span><span> should be transformed into a </span><span style=' font-style: italic;'>binary class matrix</span><span> </span><span style=' font-family: monospace;'>Y</span><span> such that </span><span style=' font-family: monospace;'>Y(i,j)</span><span> equals </span><span style=' font-family: monospace;'>1</span><span> if y(</span><span style=' font-family: monospace;'>i)==j</span><span>, and 0 otherwise.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>clear;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>load(</span><span style="color: rgb(170, 4, 249);">'ex4data1.mat'</span><span>);</span></span></div></div><div class="inlineWrapper"><div  class = 'S10'><span style="white-space: pre;"><span>Y = (1:10) == y;</span></span></div></div></div><h2  class = 'S11' id = 'H_EFAC5F00' ><span>Choose an appropriate neural network app</span></h2><div  class = 'S2'><span>As mentioned in the companion script for ex3, MATLAB neural network model variables are complicated structures that contain all of the information about the network, including the structure, weights, and other details. Instead of writing code to build and train a neural network and create a model variable from scratch, it is much easier to use one of the available apps from the Neural Network toolbox. The trained network can then be exported as a network variable to the workspace, or a script can be automatically generated which contains the code necessary for recreating and retraining a similar network at a later date. If further customization or duplication of the network is desired, one can then adapt the code in this script. </span></div><div  class = 'S2'><span>    In the Machine Learning section of the MATLAB Apps tab, you will find several interactive apps for quickly generating and training a neural network for the following applications:</span></div><ul  class = 'S3'><li  class = 'S4'><span>Clustering (</span><span style=' font-family: monospace;'>nctool</span><span>)</span></li><li  class = 'S4'><span>Regression (</span><span style=' font-family: monospace;'>nftool</span><span>)</span></li><li  class = 'S4'><span>Time Series (</span><span style=' font-family: monospace;'>ntstool</span><span>)</span></li><li  class = 'S4'><span>Pattern Recognition (</span><span style=' font-family: monospace;'>nprtool</span><span>)</span></li></ul><div  class = 'S2'><span>The apps above are launched from the 'Apps' menu or using the (*</span><span style=' font-family: monospace;'>tool</span><span>) commands listed above. Alternatively, you can launch the general </span><a href = "https://www.mathworks.com/help/deeplearning/ref/nnstart.html"><span>Neural Network Start App</span></a><span> using the command </span><span style=' font-family: monospace;'>nnstart</span><span> if you are not yet sure which app to choose. Run the code below to open the Neural Network Start app.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S12'><span style="white-space: pre;"><span>nnstart</span></span></div></div></div><h2  class = 'S11' id = 'H_3C25A619' ><span>Create and train a neural network for pattern recognition </span></h2><div  class = 'S2'><span>Once the app opens, you should see a button to launch each of the above apps listed above. Note that there is additional information and helpful examples to you get started in the 'More Information' tab. The problem of classifying the digit images is a pattern recognition and classification problem. The </span><a href = "https://www.mathworks.com/help/deeplearning/gs/classify-patterns-with-a-neural-network.html"><span>Pattern Recognition App</span></a><span> is designed to help create and train a two layer neural network suitable for this type of problem. Follow the steps in the next few sections to train a digit classifier using the Pattern Recognition App.</span></div><div  class = 'S2' id = 'H_E5277E86' ><span style=' font-weight: bold;'>Note: </span><span>If you have difficulty reading the instructions below while the app is open in MATLAB Online, export this script to a pdf file which you can then use to display the instructions in a separate browser tab or window. To export this script, click on the 'Save' button in the 'Live Editor' tab above, then select 'Export to PDF'.</span></div><h3  class = 'S13' id = 'H_DCD784CC' ><span>Open the Pattern Recognition App and select the data</span></h3><ol  class = 'S3'><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Neural Network Start</span><span> app opened previously, select the </span><span style=' font-weight: bold;'>Pattern Recognition App</span><span>.</span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Welcome</span><span> page, read the information about the pattern recognition network uses and structure, then click </span><span style=' font-weight: bold;'>Next</span><span>.</span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Select Data</span><span> page, select X from the </span><span style=' font-weight: bold;'>Inputs</span><span> list, select Y from the </span><span style=' font-weight: bold;'>Targets</span><span> list, and select '</span><span style=' font-weight: bold;'>Matrix rows</span><span>' for the sample orientation, then click '</span><span style=' font-weight: bold;'>Next</span><span>'.</span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Validation and Test Data</span><span> page, select 5% for '</span><span style=' font-weight: bold;'>Validation</span><span>' and '</span><span style=' font-weight: bold;'>Testing</span><span>' and click '</span><span style=' font-weight: bold;'>Next</span><span>'.</span></li></ol><h3  class = 'S14' id = 'H_5515265E' ><span>Create and train the network</span></h3><div  class = 'S2'><span>The network input and output layer sizes are determined from the data selected. The number of layers is automatically determined from the network type (pattern recognition in this case). All that is left is to select the number of neurons in the hidden layer and train the network.</span></div><ol  class = 'S3'><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Network Architecture</span><span> page, enter '25' for the '</span><span style=' font-weight: bold;'>Number of Hidden Neurons</span><span>' and click '</span><span style=' font-weight: bold;'>Next</span><span>'.</span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Train Network</span><span> page, click the '</span><span style=' font-weight: bold;'>Train</span><span>' button. The </span><span style=' font-weight: bold;'>Neural Network Training Tool</span><span> app will automatically open and train network. When the training is finished, several plots are available for inspection which provide information on the training and performance of the network model in the '</span><span style=' font-weight: bold;'>Plots</span><span>' section of the </span><span style=' font-weight: bold;'>Neural Network Training Tool</span><span>.</span></li><li  class = 'S4'><span>Close the </span><span style=' font-weight: bold;'>Neural Network Training Tool</span><span>, return to the </span><span style=' font-weight: bold;'>Pattern Recognition App</span><span>, and click '</span><span style=' font-weight: bold;'>Next</span><span>'. </span></li></ol><h3  class = 'S14' id = 'H_94AFB2C8' ><span>Evaluate and export the network</span></h3><div  class = 'S2'><span>After creating and training the network, there are available options for visualizing the network's performance and making adjustments if needed. Once the network is performing well, it can be exported as a network variable to the workspace, or a script can be generated for building and training similar networks in the future.</span></div><ol  class = 'S3'><li  class = 'S4'><span>Inspect the options for improving the neural network performance or testing the network on additional data in the </span><span style=' font-weight: bold;'>Evaluate Network</span><span> page. </span></li><li  class = 'S4'><span>Since the performance is satisfactory (and we have no additional data) click '</span><span style=' font-weight: bold;'>Next</span><span>'.</span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Deploy Solution</span><span> page, available options are shown for deploying the network. Click '</span><span style=' font-weight: bold;'>Next'</span><span> to skip deployment. </span></li><li  class = 'S4'><span>In the </span><span style=' font-weight: bold;'>Save Results</span><span> page, click the '</span><span style=' font-weight: bold;'>Simple Script</span><span>' button in the '</span><span style=' font-weight: bold;'>Generate Scripts</span><span>' section to generate a script for recreating and training the network in the future. Inspect the script and discard it when you are done (this script has already been adapted to train a custom network in the next part of this script).</span></li><li  class = 'S4'><span>Select the '</span><span style=' font-weight: bold;'>Save network to MATLAB Object named:</span><span>' checkbox in the '</span><span style=' font-weight: bold;'>Save Data to Workspace</span><span>' section and de-select the other boxes. </span></li><li  class = 'S4'><span>Enter the network variable name, '</span><span style=' font-weight: bold;'>net</span><span>', in the corresponding box, then click the '</span><span style=' font-weight: bold;'>Save Results</span><span>' button to export the neural network variable to the workspace.</span></li><li  class = 'S4'><span>Click the '</span><span style=' font-weight: bold;'>Finish</span><span>' button to exit the </span><span style=' font-weight: bold;'>Pattern Recognition App</span><span> and close the </span><span style=' font-weight: bold;'>Neural Network Start App</span><span>.</span></li></ol><h2  class = 'S11' id = 'H_3CD5A081' ><span>Predict digits using the trained network variable</span></h2><div  class = 'S2'><span>Run the code below to estimate the class of a random example using the network variable you trained above, compare with the true class, and display the corresponding image using the trained network:</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>i = randi(length(y));</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>ysim = net(X(i,:)');</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>[~,class] = max(ysim);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>imshow(reshape(X(i,:),20,20))</span></span></div></div><div class="inlineWrapper"><div  class = 'S10'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(170, 4, 249);">'True class: %d  |  Predicted class: %d | Probability of match: %.1f%%'</span><span>,y(i),class,100*ysim(class));</span></span></div></div></div><h1  class = 'S0' id = 'T_E3BFF74C' ><span>Build and Train a Customized Neural Network Programatically</span></h1><div  class = 'S2'><span>In the first part of this live script you used the Pattern Recognition App to build and train a neural network. If you wish to utilize additional options when building or training a network, for example using regularization or a custom activation function, the neural network apps can generate a script which can be adapted with the desired customizations. This is often more efficient and robust method than writing your own code to build and train a network.</span></div><h2  class = 'S1' id = 'H_5E627C75' ><span>Train a custom network with regularization</span></h2><div  class = 'S2'><span>A local function for building and training a pattern recognition network, </span><span style=' font-family: monospace;'>imageNet</span><span>, has been provided at the end of this script. When called, it will build, train, and return neural network model variable which can be used for classifying digit images. The code in </span><span style=' font-family: monospace;'>imageNet</span><span> was generated by the Neural Net Pattern Recognition App using the steps in the previous section and then adapted with custom options and parameters, including regularization.</span></div><div  class = 'S2'><span>    Run the code below to call </span><span style=' font-family: monospace;'>imageNet</span><span>, which will create and train a two-layer, feed-forward neural network using the settings for </span><span style=' font-family: monospace;'>lambda</span><span> and </span><span style=' font-family: monospace;'>MaxIter</span><span> you provide below. Note that </span><span style=' font-family: monospace;'>imageNet</span><span> is a local function - it can only be called from inside this Live Script. The training accuracy is then displayed for comparison with your previous results.  Note that without regularization, it is possible to achieve a training accuracy 100% if training is allowed to continue for enough epochs (iterations). However, the model will likely not generalize well to new data as discussed in the lectures. Use the controls below to explore the effect of regularization and training epochs on the final model.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Change lambda and MaxIter to see how it affects the result</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>lambda = </span></span><span>0.1</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>MaxIter = </span></span><span>40</span><span style="white-space: pre;"><span>;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net = imageNet(X,Y,lambda,MaxIter);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>[~,ysim] = max(net(X'));</span></span></div></div><div class="inlineWrapper"><div  class = 'S10'><span style="white-space: pre;"><span>fprintf(</span><span style="color: rgb(170, 4, 249);">'Training accuracy: %g%%'</span><span>,100*sum(y == ysim')/length(y));</span></span></div></div></div><h1  class = 'S0' id = 'T_83081B30' ><span>Local Functions</span></h1><h2  class = 'S1' id = 'H_D044A2ED' ><span>imageNet</span></h2><div  class = 'S2'><span style=' font-family: monospace;'>imageNet</span><span> trains a neural network using custom parameter settings and returns the network variable. This function was adapted from a script generated by the Pattern Recognition App.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">function </span><span>net = imageNet(X,Y,lambda,MaxIter) </span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Build, train, and return a neural network model to classify the 1x400 images</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% of digits in X with labels in Y</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% MATLAB neural networks prefer examples in columns and labels in rows</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>X = X';</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>Y = Y';</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Set network options:</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>hiddenLayerSize = 25; </span><span style="color: rgb(2, 128, 9);">% Create a neural net with a single hidden layer with 25 output neurons</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>trainFcn = </span><span style="color: rgb(170, 4, 249);">'trainscg'</span><span>;  </span><span style="color: rgb(2, 128, 9);">% Use scaled conjugate gradient backpropagation</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net = patternnet(hiddenLayerSize, trainFcn); </span><span style="color: rgb(2, 128, 9);">% Create the net variable</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.layers{1}.transferFcn = </span><span style="color: rgb(170, 4, 249);">'logsig'</span><span>; </span><span style="color: rgb(2, 128, 9);">% Change default transfer function to match ex3/4 implementation</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Add regularization: </span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Note that the MATLAB regularization parameter must lie between 0 and 1,</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% where 0 correspnds to lambda = 0 (no regularization) and 1 corresponds to lambda = inf. </span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% We map the input lambda value to [0,1] using tanh function</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.performParam.regularization = tanh(lambda);  </span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.trainParam.epochs = MaxIter;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.trainParam.showWindow = false; </span><span style="color: rgb(2, 128, 9);">% Don't show training GUI</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Setup Division of Data for Training, Validation, Testing </span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% This example uses all of the data for training (to match ex3/ex4 network example)</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Validation and test data is discussed later in the course</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.divideParam.trainRatio = 100/100;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.divideParam.valRatio = 0/100;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net.divideParam.testRatio = 0/100;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Train the Network</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>net = train(net,X,Y);</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span style="color: rgb(14, 0, 255);">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S10'></div></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% MATLAB Companion Script for _Machine Learning_ ex4 (Optional)
%% Introduction
% Coursera's _Machine Learning_ was designed to provide you with a greater understanding 
% of machine learning algorithms- what they are, how they work, and where to apply 
% them. You are also shown techniques to improve their performance and to address 
% common issues. As is mentioned in the course, there are many tools available 
% that allow you to use machine learning algorithms _without_ having to implement 
% them yourself. This Live Script was created by MathWorks to help _Machine Learning_ 
% students explore the data analysis and machine learning tools available in MATLAB.
%% FAQ
% *Who is this intended for?*
%% 
% * This script is intended for students using MATLAB Online who have completed 
% ex4 and want to learn more about the corresponding machine learning tools in 
% MATLAB.
%% 
% *How do I use this script?*
%% 
% * In the sections that follow, read the information provided about the data 
% analysis and machine learning tools in MATLAB, then run the code in each section 
% and examine the results. You may also be presented with instructions for using 
% a MATLAB machine learning app. This script should be located in the ex4 folder 
% which should be set as your Current Folder in MATLAB Online.
%% 
% *Can I use the tools in this companion script to complete the programming 
% exercises?*
%% 
% * No. Most algorithm steps implemented in the programming exercises are handled 
% automatically by MATLAB machine learning functions. Additionally, the results 
% will be similar, but not identical, to those in the programming exercises due 
% to differences in implementation, parameter settings, and randomization.
%% 
% *Where can I obtain help with this script or report issues?*
%% 
% * As this script is not part of the original course materials, please direct 
% any questions, comments, or issues to the _MATLAB Help_ discussion forum.
%% Create and Train a Neural Network in MATLAB
% In this Live Script, we will use the _Neural Net Pattern Recognition App_ 
% from the <https://www.mathworks.com/products/neural-network.html Neural Network 
% Toolbox> to build and train a neural network for hand-written digit recognition.
%% Files needed for this script
%% 
% * |ex4data1.mat| - Training set of hand-written digits
%% Create a Pattern Recognition Network using |nprtool|
%% Load the data
% Run the code in this section to load the image data matrix |X| and the digit 
% label vector |y|. Note that before creating and training a multi-class neural 
% network classifier in MATLAB, the label vector |y| should be transformed into 
% a _binary class matrix_ |Y| such that |Y(i,j)| equals |1| if y(|i)==j|, and 
% 0 otherwise.

clear;
load('ex4data1.mat');
Y = (1:10) == y;
%% Choose an appropriate neural network app
% As mentioned in the companion script for ex3, MATLAB neural network model 
% variables are complicated structures that contain all of the information about 
% the network, including the structure, weights, and other details. Instead of 
% writing code to build and train a neural network and create a model variable 
% from scratch, it is much easier to use one of the available apps from the Neural 
% Network toolbox. The trained network can then be exported as a network variable 
% to the workspace, or a script can be automatically generated which contains 
% the code necessary for recreating and retraining a similar network at a later 
% date. If further customization or duplication of the network is desired, one 
% can then adapt the code in this script. 
% 
% In the Machine Learning section of the MATLAB Apps tab, you will find several 
% interactive apps for quickly generating and training a neural network for the 
% following applications:
%% 
% * Clustering (|nctool|)
% * Regression (|nftool|)
% * Time Series (|ntstool|)
% * Pattern Recognition (|nprtool|)
%% 
% The apps above are launched from the 'Apps' menu or using the (*|tool|) commands 
% listed above. Alternatively, you can launch the general <https://www.mathworks.com/help/deeplearning/ref/nnstart.html 
% Neural Network Start App> using the command |nnstart| if you are not yet sure 
% which app to choose. Run the code below to open the Neural Network Start app.

nnstart
%% Create and train a neural network for pattern recognition 
% Once the app opens, you should see a button to launch each of the above apps 
% listed above. Note that there is additional information and helpful examples 
% to you get started in the 'More Information' tab. The problem of classifying 
% the digit images is a pattern recognition and classification problem. The <https://www.mathworks.com/help/deeplearning/gs/classify-patterns-with-a-neural-network.html 
% Pattern Recognition App> is designed to help create and train a two layer neural 
% network suitable for this type of problem. Follow the steps in the next few 
% sections to train a digit classifier using the Pattern Recognition App.
%% 
% *Note:* If you have difficulty reading the instructions below while the app 
% is open in MATLAB Online, export this script to a pdf file which you can then 
% use to display the instructions in a separate browser tab or window. To export 
% this script, click on the 'Save' button in the 'Live Editor' tab above, then 
% select 'Export to PDF'.
% Open the Pattern Recognition App and select the data
%% 
% # In the *Neural Network Start* app opened previously, select the *Pattern 
% Recognition App*.
% # In the *Welcome* page, read the information about the pattern recognition 
% network uses and structure, then click *Next*.
% # In the *Select Data* page, select X from the *Inputs* list, select Y from 
% the *Targets* list, and select '*Matrix rows*' for the sample orientation, then 
% click '*Next*'.
% # In the *Validation and Test Data* page, select 5% for '*Validation*' and 
% '*Testing*' and click '*Next*'.
% Create and train the network
% The network input and output layer sizes are determined from the data selected. 
% The number of layers is automatically determined from the network type (pattern 
% recognition in this case). All that is left is to select the number of neurons 
% in the hidden layer and train the network.
%% 
% # In the *Network Architecture* page, enter '25' for the '*Number of Hidden 
% Neurons*' and click '*Next*'.
% # In the *Train Network* page, click the '*Train*' button. The *Neural Network 
% Training Tool* app will automatically open and train network. When the training 
% is finished, several plots are available for inspection which provide information 
% on the training and performance of the network model in the '*Plots*' section 
% of the *Neural Network Training Tool*.
% # Close the *Neural Network Training Tool*, return to the *Pattern Recognition 
% App*, and click '*Next*'. 
% Evaluate and export the network
% After creating and training the network, there are available options for visualizing 
% the network's performance and making adjustments if needed. Once the network 
% is performing well, it can be exported as a network variable to the workspace, 
% or a script can be generated for building and training similar networks in the 
% future.
%% 
% # Inspect the options for improving the neural network performance or testing 
% the network on additional data in the *Evaluate Network* page. 
% # Since the performance is satisfactory (and we have no additional data) click 
% '*Next*'.
% # In the *Deploy Solution* page, available options are shown for deploying 
% the network. Click '*Next'* to skip deployment. 
% # In the *Save Results* page, click the '*Simple Script*' button in the '*Generate 
% Scripts*' section to generate a script for recreating and training the network 
% in the future. Inspect the script and discard it when you are done (this script 
% has already been adapted to train a custom network in the next part of this 
% script).
% # Select the '*Save network to MATLAB Object named:*' checkbox in the '*Save 
% Data to Workspace*' section and de-select the other boxes. 
% # Enter the network variable name, '*net*', in the corresponding box, then 
% click the '*Save Results*' button to export the neural network variable to the 
% workspace.
% # Click the '*Finish*' button to exit the *Pattern Recognition App* and close 
% the *Neural Network Start App*.
%% Predict digits using the trained network variable
% Run the code below to estimate the class of a random example using the network 
% variable you trained above, compare with the true class, and display the corresponding 
% image using the trained network:

i = randi(length(y));
ysim = net(X(i,:)');
[~,class] = max(ysim);
imshow(reshape(X(i,:),20,20))
fprintf('True class: %d  |  Predicted class: %d | Probability of match: %.1f%%',y(i),class,100*ysim(class));
%% Build and Train a Customized Neural Network Programatically
% In the first part of this live script you used the Pattern Recognition App 
% to build and train a neural network. If you wish to utilize additional options 
% when building or training a network, for example using regularization or a custom 
% activation function, the neural network apps can generate a script which can 
% be adapted with the desired customizations. This is often more efficient and 
% robust method than writing your own code to build and train a network.
%% Train a custom network with regularization
% A local function for building and training a pattern recognition network, 
% |imageNet|, has been provided at the end of this script. When called, it will 
% build, train, and return neural network model variable which can be used for 
% classifying digit images. The code in |imageNet| was generated by the Neural 
% Net Pattern Recognition App using the steps in the previous section and then 
% adapted with custom options and parameters, including regularization.
% 
% Run the code below to call |imageNet|, which will create and train a two-layer, 
% feed-forward neural network using the settings for |lambda| and |MaxIter| you 
% provide below. Note that |imageNet| is a local function - it can only be called 
% from inside this Live Script. The training accuracy is then displayed for comparison 
% with your previous results.  Note that without regularization, it is possible 
% to achieve a training accuracy 100% if training is allowed to continue for enough 
% epochs (iterations). However, the model will likely not generalize well to new 
% data as discussed in the lectures. Use the controls below to explore the effect 
% of regularization and training epochs on the final model.

% Change lambda and MaxIter to see how it affects the result
lambda = 0.1;
MaxIter = 40;
net = imageNet(X,Y,lambda,MaxIter);
[~,ysim] = max(net(X'));
fprintf('Training accuracy: %g%%',100*sum(y == ysim')/length(y));
%% Local Functions
%% imageNet
% |imageNet| trains a neural network using custom parameter settings and returns 
% the network variable. This function was adapted from a script generated by the 
% Pattern Recognition App.

function net = imageNet(X,Y,lambda,MaxIter) 
% Build, train, and return a neural network model to classify the 1x400 images
% of digits in X with labels in Y

% MATLAB neural networks prefer examples in columns and labels in rows
X = X';
Y = Y';

% Set network options:
hiddenLayerSize = 25; % Create a neural net with a single hidden layer with 25 output neurons
trainFcn = 'trainscg';  % Use scaled conjugate gradient backpropagation
net = patternnet(hiddenLayerSize, trainFcn); % Create the net variable
net.layers{1}.transferFcn = 'logsig'; % Change default transfer function to match ex3/4 implementation

% Add regularization: 
% Note that the MATLAB regularization parameter must lie between 0 and 1,
% where 0 correspnds to lambda = 0 (no regularization) and 1 corresponds to lambda = inf. 
% We map the input lambda value to [0,1] using tanh function
net.performParam.regularization = tanh(lambda);  
net.trainParam.epochs = MaxIter;
net.trainParam.showWindow = false; % Don't show training GUI

% Setup Division of Data for Training, Validation, Testing 
% This example uses all of the data for training (to match ex3/ex4 network example)
% Validation and test data is discussed later in the course
net.divideParam.trainRatio = 100/100;
net.divideParam.valRatio = 0/100;
net.divideParam.testRatio = 0/100;

% Train the Network
net = train(net,X,Y);
end
##### SOURCE END #####
--></body></html>